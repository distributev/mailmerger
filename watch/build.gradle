class MailMerger extends DefaultTask {

    String mmJar
    File watchDirectory
    File completedDirectory
    File configFile

    @InputDirectory
    File getSourceFiles() {
        return this.watchDirectory
    }

    @TaskAction
    void sayGreeting() {
        def files = watchDirectory.listFiles()
        files.each { file ->
            String com = "java -jar ${mmJar} -f ${file.getPath()} -c ${configFile.getPath()}"
            com.execute().waitFor()
            file.renameTo(new File(completedDirectory, file.getName()))
        }
    }
}

task mailMerger (type : MailMerger) {
    mmJar = project.property("mmJar")
    watchDirectory = file(project.property("watchDir"))
    completedDirectory = file(project.property("completedDir"))
    configFile = file(project.property("configFile"))
}
